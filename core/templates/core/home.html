{% extends 'account/base.html' %}
{% load static %}
{% load core_extras %}

{% block content %}
    <div class="mb-5">
        <legend class="">Recent Requests</legend>
        <hr>

        {% if not reqs %}
            <div class="content-section text-center text-secondary">
                <i>No requests</i>
            </div>
        {% endif %}

        {% for req in reqs|slice:"0:3" %}
            <article class="content-section my-3">
                <div class="media">
                    {% if req.user.profile %}
                    <img class="mr-2 rounded-circle article-img" src="{{ req.user.profile.avatar.url }}" height="25px" width="25px">
                    {% else %}
                    <img class="mr-2 rounded-circle article-img" src="{% url 'media-server' filename='default-avatar.jpg' %}" height="25px" width="25px">
                    {% endif %}
                    <div class="article-metadata" style="">
                        <a class="anchor mr-2" href="{% url 'profile' username=req.user.username %}">{{ req.user }}</a>
                        <small class="text-muted">{{ req.date }}</small>
                    </div>
                </div>

                <div class="media-body">
                    <hr class="my-2 py-0">

                    <div class="row">
                        <div class="col">
                            <div class="">
                                <h4><a class="article-title" href="{% url 'request-details' req_id=req.id %}">{{ req.title }}</a></h4>
                                <!-- <h6 class="article-content">{{ req.description }}</h6> -->
                            </div>

                            <small>
                                {% if req.is_closed %}
                                <a class="anchor tag px-2" style="color: green; background: #a2f2cf;">Completed</a>
                                {% endif %}
                                <a class="anchor tag px-2" href="{% url 'all-requests' %}{% urlparams branch=req.branch %}">{{ req.branch }}</a>
                                <a class="anchor tag px-2" href="{% url 'all-requests' %}{% urlparams semester=req.semester %}">Semester: {{ req.semester }}</a>
                            </small>
                        </div>

                        {% if user.is_authenticated %}
                            <div class="col-auto border-left">
                                <div class="" style="min-width: 50px;">
                                    {% if user in req.upvotes.all %}
                                        <button id="reqUp" class="w-100 mb-1 btn btn-sm btn-success" onclick="CastVoteUtil(0, 1, {{ req.id }})" type="button" name="button">
                                            <i class="fa fa-caret-up" aria-hidden="true"></i>
                                            {{ req.upvotes.all|length }}
                                        </button>
                                    {% else %}
                                        <button id="reqUp" class="w-100 mb-1 btn btn-sm btn-normal" onclick="CastVoteUtil(0, 1, {{ req.id }})" type="button" name="button">
                                            <i class="fa fa-caret-up" aria-hidden="true"></i>
                                            {{ req.upvotes.all|length }}
                                        </button>
                                    {% endif %}
                                </div>
                                <div class="" style="min-width: 50px;">
                                    {% if user in req.downvotes.all %}
                                        <button id="reqDown" class="w-100 btn btn-sm btn-danger" type="button" onclick="CastVoteUtil(0, -1, {{ req.id }})" name="button">
                                            <i class="fa fa-caret-down" aria-hidden="true"></i>
                                            {{ req.downvotes.all|length }}
                                        </button>
                                    {% else %}
                                        <button id="reqDown" class="w-100 btn btn-sm btn-normal" type="button" onclick="CastVoteUtil(0, -1, {{ req.id }})" name="button">
                                            <i class="fa fa-caret-down" aria-hidden="true"></i>
                                            {{ req.downvotes.all|length }}
                                        </button>
                                    {% endif %}
                                </div>
                            </div>
                        {% else %}
                            <div class="col-auto border-left">
                                <div class="p-0" style="min-width: 50px;">
                                    <label class="w-100 btn btn-sm border mb-1" type="" name="">
                                        <i class="fa fa-caret-up" aria-hidden="true"></i>
                                        {{ req.upvotes.all|length }}
                                    </label>
                                </div>
                                <div class="p-0" style="min-width: 50px;">
                                    <label class="w-100 btn btn-sm border my-0" type="" name="">
                                        <i class="fa fa-caret-down" aria-hidden="true"></i>
                                        {{ req.downvotes.all|length }}
                                    </label>
                                </div>
                            </div>
                        {% endif %}
                    </div>

                </div>
            </article>
        {% endfor %}

        {% if reqs|length > 3 %}
            <div class="">
                <a class="btn btn-sm btn-block btn-outline-info" style="" href="{% url 'all-requests'%}">See all requests</a>
            </div>
        {% endif %}
    </div>
    <hr class="w-50">

    <div class="mb-5">
        <legend class="">Recent Uploads</legend>
        <hr>

        {% if not files %}
            <div class="content-section text-center text-secondary">
                <i>No Files</i>
            </div>
        {% endif %}

        {% for file in files|slice:"0:3" %}
            <article class="content-section">
                <div class="media">
                    {% if file.user.profile %}
                        <img class="mr-2 rounded-circle article-img" src="{{ file.user.profile.avatar.url }}" height="25px" width="25px">
                    {% else %}
                        <img class="mr-2 rounded-circle article-img" src="{% url 'media-server' filename='default-avatar.jpg' %}" height="25px" width="25px">
                    {% endif %}

                    <div class="article-metadata" style="">
                        <a class="anchor mr-2" href="{% url 'profile' username=file.user.username %}">{{ file.user }}</a>
                        <small class="text-muted">{{ file.upload_date }}</small>
                    </div>
                </div>

                <div class="media-body">
                    <hr class="my-2 py-0">

                    <div class="row">
                        <div class="col">
                            <div class="">
                                <h4><a class="article-title" href="{% url 'download' %}{% urlparams fileid=file.id%}">{{ file.filename }}</a></h4>
                                <!-- <h6 class="article-content">{{ file.description }}</h6> -->
                            </div>

                            <small>
                                <a class="anchor tag px-2" href="{% url 'all-uploads' %}{% urlparams branch=file.branch %}">{{ file.branch }}</a>
                                <a class="anchor tag px-2" href="{% url 'all-uploads' %}{% urlparams semester=file.semester %}">Semester: {{ file.semester }}</a>
                            </small>
                        </div>

                        {% if user.is_authenticated %}
                            <div class="col-auto border-left py-1">
                                <div class="" style="min-width: 50px;">
                                    {% if user in file.upvotes.all %}
                                        <button id="reqUp" class="w-100 mb-1 btn btn-sm btn-success" onclick="CastVoteUtil(1, 1, {{ file.id }})" type="button" name="button">
                                            <i class="fa fa-caret-up" aria-hidden="true"></i>
                                            {{ file.upvotes.all|length }}
                                        </button>
                                    {% else %}
                                        <button id="reqUp" class="w-100 mb-1 btn btn-sm btn-normal" onclick="CastVoteUtil(1, 1, {{ file.id }})" type="button" name="button">
                                            <i class="fa fa-caret-up" aria-hidden="true"></i>
                                            {{ file.upvotes.all|length }}
                                        </button>
                                    {% endif %}
                                </div>

                                <div class="" style="min-width: 50px;">
                                    {% if user in file.downvotes.all %}
                                        <button id="reqDown" class="w-100 btn btn-sm btn-danger" type="button" onclick="CastVoteUtil(1, -1, {{ file.id }})" name="button">
                                            <i class="fa fa-caret-down" aria-hidden="true"></i>
                                            {{ file.downvotes.all|length }}
                                        </button>
                                    {% else %}
                                        <button id="reqDown" class="w-100 btn btn-sm btn-normal" type="button" onclick="CastVoteUtil(1, -1, {{ file.id }})" name="button">
                                            <i class="fa fa-caret-down" aria-hidden="true"></i>
                                            {{ file.downvotes.all|length }}
                                        </button>
                                    {% endif %}
                                </div>
                            </div>
                        {% else %}
                            <div class="col-auto border-left py-1">
                                <div class="" style="min-width: 50px;">
                                    <label class="w-100 btn btn-sm border mb-1">
                                        <i class="fa fa-caret-up" aria-hidden="true"></i>
                                        {{ file.upvotes.all|length }}
                                    </label>
                                </div>

                                <div class="" style="min-width: 50px;">
                                    <label class="w-100 btn btn-sm border my-0">
                                        <i class="fa fa-caret-down" aria-hidden="true"></i>
                                        {{ file.downvotes.all|length }}
                                    </label>
                                </div>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </article>
        {% endfor %}

        {% if files|length > 3 %}
            <div class="">
                <form>
                    <button class="btn btn-sm btn-block btn-outline-info" style="" formaction="{% url 'all-uploads' %}">See all files</button>
                </form>
            </div>
        {% endif %}
    </div>

{% endblock content %}
